.d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
  %h1.h2= @event.title
  .btn-toolbar.mb-2.mb-md-0
    = link_to 'Edit', edit_admin_event_path(@event), class: 'btn btn-primary'
    = link_to 'Back', admin_events_path, class: 'btn btn-secondary'

.row
  .col-lg-8
    .card
      .card-header
        %h5.card-title Event Details
      .card-body
        %p
          %strong Description:
          = @event.description
        %p
          %strong Date:
          = @event.date&.strftime('%Y-%m-%d %H:%M')
        %p
          %strong Address:
          = @event.address
  
  .col-lg-4
    .card
      .card-header.d-flex.justify-content-between.align-items-center
        %h5.card-title Assistants (#{@event.assistants.count})
        .dropdown
          %button.btn.btn-sm.btn-primary.dropdown-toggle{type: "button", "data-bs-toggle" => "dropdown"}
            Add Assistants
          %ul.dropdown-menu
            %li
              = link_to 'Add Single Assistant', new_admin_event_assistant_path(@event), class: 'dropdown-item'
            %li
              %a.dropdown-item{href: "#", "data-bs-toggle" => "modal", "data-bs-target" => "#uploadModal"}
                Upload XLSX File
      .card-body
        - if @event.assistants.any?
          .list-group
            - @event.assistants.each do |assistant|
              .list-group-item.d-flex.justify-content-between.align-items-center
                .d-flex.flex-column
                  %strong= assistant.name
                  %small.text-muted= assistant.email
                  %small.text-muted= assistant.phone
                  - if assistant.open1.present? || assistant.open2.present? || assistant.open3.present?
                    .mt-1
                      - if assistant.open1.present?
                        %span.badge.bg-light.text-dark.me-1= assistant.open1
                      - if assistant.open2.present?
                        %span.badge.bg-light.text-dark.me-1= assistant.open2
                      - if assistant.open3.present?
                        %span.badge.bg-light.text-dark.me-1= assistant.open3
                .btn-group
                  = link_to 'Edit', edit_admin_event_assistant_path(@event, assistant), class: 'btn btn-sm btn-outline-secondary'
                  = link_to 'Delete', admin_event_assistant_path(@event, assistant), method: :delete, 
                    confirm: 'Are you sure?', class: 'btn btn-sm btn-outline-danger'
        - else
          %p.text-muted No assistants yet.

#uploadModal.modal.fade{tabindex: "-1"}
  .modal-dialog
    .modal-content
      .modal-header
        %h5.modal-title Upload Assistants XLSX
        %button.btn-close{type: "button", "data-bs-dismiss" => "modal"}
      = form_with url: upload_assistants_admin_event_path(@event), method: :post, 
        multipart: true, local: true, class: 'modal-body' do |form|
        .mb-3
          = form.label :file, 'Select XLSX file:', class: 'form-label'
          = form.file_field :file, accept: '.xlsx,.xls', class: 'form-control', required: true
        .mb-3
          %small.text-muted
            %strong Expected format:
            %br
            Column A: Name, Column B: Email, Column C: Phone
            %br
            Column D: Extra Field 1, Column E: Extra Field 2, Column F: Extra Field 3 (optional)
            %br
            First row should contain headers (will be skipped)
        .modal-footer
          %button.btn.btn-secondary{type: "button", "data-bs-dismiss" => "modal"} Cancel
          = form.submit 'Upload Assistants', class: 'btn btn-primary'